/******/ (() => { // webpackBootstrap
var __webpack_exports__ = {};
/*!**************************************!*\
  !*** ./shader-balls/shader-balls.ts ***!
  \**************************************/
function assert(condition, message = null) {
    if (!condition) {
        throw new Error(message || "Assertion failed");
    }
}
var vertex_shader_source = `#version 300 es
in vec3 a_position;

out vec3 vColor;

void main() {
    gl_Position = vec4(a_position, 1.0);
    vColor = vec3(a_position.x + 0.5, a_position.y + 0.5, a_position.z + 0.5); // Color based on position
}`;
var fragment_shader_source = `#version 300 es
precision mediump float;

in vec3 vColor;
out vec4 outColor;

uniform sampler2D uTexture;

void main() {
    outColor = vec4(vColor, 1.0);
}`;
class Vector3 {
    constructor(x = 0, y = 0, z = 0) {
        this.x = x;
        this.y = y;
        this.z = z;
    }
}
class Transform {
    constructor(position = new Vector3(), rotation = new Vector3()) {
        this.position = position;
        this.rotation = rotation;
    }
}
class RenderObject {
    constructor(texture_id = null, mesh_id = null, transform = new Transform()) {
        this.texture_id = texture_id;
        this.mesh_id = mesh_id;
        this.transform = transform;
    }
}
class Mesh {
    constructor(vertex_buffer, index_buffer = null, index_buffer_used = false) {
        this.vertex_buffer = vertex_buffer;
        this.index_buffer = index_buffer;
        this.index_buffer_used = index_buffer_used;
    }
}
;
class FloatMatrix {
    constructor(buffer, m, n) {
        this.m = m;
        this.n = n;
        this.buffer = buffer;
    }
    rotate_vector(column_vector) {
        assert(this.m == 3 && this.n == 3);
        let multiplied_column = new Vector3();
        multiplied_column.x += column_vector.x * this.buffer[0];
        multiplied_column.x += column_vector.y * this.buffer[1];
        multiplied_column.x += column_vector.z * this.buffer[2];
        multiplied_column.y += column_vector.x * this.buffer[3];
        multiplied_column.y += column_vector.y * this.buffer[4];
        multiplied_column.y += column_vector.z * this.buffer[5];
        multiplied_column.z += column_vector.x * this.buffer[6];
        multiplied_column.z += column_vector.y * this.buffer[7];
        multiplied_column.z += column_vector.z * this.buffer[8];
        return multiplied_column;
    }
    multiply(matrix_b) {
        let dot_product = new FloatMatrix(new Float64Array(this.m * matrix_b.n), this.m, matrix_b.n);
        for (let a_row = 0; a_row < this.m; a_row++) {
            for (let b_col = 0; b_col < matrix_b.n; b_col++) {
                let product_sum = 0;
                let count = 0;
                while (count < this.n) {
                    product_sum += this.buffer[a_row * this.n + count] * matrix_b.buffer[count * matrix_b.n + b_col];
                    console.log(`product_sum: ${product_sum}, a_row: ${a_row}, b_col: ${b_col}, count: ${count}`);
                    count += 1;
                }
                dot_product.buffer[a_row * dot_product.n + b_col] = product_sum;
            }
        }
        return dot_product;
    }
}
;
var render_objects = new Array();
var texture_map = new Map();
var mesh_map = new Map();
function render() {
    requestAnimationFrame(render);
}
function start() {
    render();
}
function create_y_axis_rotation_matrix(theta) {
    return new FloatMatrix(new Float64Array([Math.cos(theta), 0, Math.sin(theta), 0, 1, 0, -Math.sin(theta), 0, Math.cos(theta)]), 3, 3);
}
function create_sphere_mesh(radius_meters = 1, segments = 6, rings = 12) {
    let sphere_vertices = [new Vector3(0, 1, 0)];
    for (let i = 1; i < rings - 1; i++) {
        let theta = Math.PI / 2 - (Math.PI / rings * i);
        let x = Math.cos(theta) * radius_meters;
        let y = Math.sin(theta) * radius_meters;
        sphere_vertices.push(new Vector3(x, y));
        for (let j = 0; j < segments; j++) {
            let new_theta = Math.PI * 2 * j / segments;
            let rotation_matrix = create_y_axis_rotation_matrix(new_theta);
            sphere_vertices.push(rotation_matrix.rotate_vector(sphere_vertices[i]));
        }
    }
    let sphere_indices = [];
    for (let i = 0; i < segments - 1; i++) {
        sphere_indices.push(0);
        sphere_indices.push(i + 1);
        sphere_indices.push(i + 2);
    }
    for (let ring_index = 0; ring_index < rings - 2; ring_index++) {
        for (let segment_index = 0; segment_index < segments - 1; segment_index++) {
            sphere_indices.push(ring_index * segments + 1 + segment_index);
            sphere_indices.push(ring_index * segments + 2 + segment_index);
            sphere_indices.push((ring_index + 1) * segments + segment_index * 2);
            sphere_indices.push(ring_index * segments + 1 + segment_index);
            sphere_indices.push((ring_index + 1) * segments + 1 + segment_index * 2);
            sphere_indices.push((ring_index + 1) * segments + 1 + (segment_index + 1) * 2);
        }
    }
    for (let i = 0; i < segments - 1; i++) {
        sphere_indices.push(sphere_vertices.length - 1);
        sphere_indices.push(sphere_vertices.length - 2 - i);
        sphere_indices.push(sphere_vertices.length - 3 - i);
    }
    let vertex_buffer = new Array();
    for (let vertex_index = 0; vertex_index < sphere_vertices.length; vertex_index++) {
        vertex_buffer.push(sphere_vertices[vertex_index].x);
        vertex_buffer.push(sphere_vertices[vertex_index].y);
        vertex_buffer.push(sphere_vertices[vertex_index].z);
    }
    return new Mesh(new Float32Array(vertex_buffer), new Uint16Array(sphere_indices), true);
}
function create_rect_mesh(x, y, z, width, height) {
    return new Mesh(new Float32Array([
        // First tri
        x, y, z,
        x + width, y, z,
        x, y + height, z,
        // Second tri
        x + width, y, z,
        x, y + height, z,
        x + width, y + height, z,
    ]));
}
let meshes = new Map();
const SPHERE_MESH = 0;
meshes.set(SPHERE_MESH, create_sphere_mesh(1, 5, 5));
const RECT_MESH = 1;
meshes.set(RECT_MESH, create_rect_mesh(0, 0, 0, 5, 5));
let current_mesh = meshes.get(SPHERE_MESH);
let canvas = document.getElementsByTagName("canvas").item(0);
let gl = canvas.getContext("webgl2");
let objects = [new RenderObject(null, RECT_MESH, new Transform(new Vector3(0, 0, 0), new Vector3(0, 0, 0)))];
const vertex_shader = gl.createShader(gl.VERTEX_SHADER);
gl.shaderSource(vertex_shader, vertex_shader_source);
gl.compileShader(vertex_shader);
const fragment_shader = gl.createShader(gl.FRAGMENT_SHADER);
gl.shaderSource(fragment_shader, fragment_shader_source);
gl.compileShader(fragment_shader);
const shader_program = gl.createProgram();
gl.attachShader(shader_program, vertex_shader);
gl.attachShader(shader_program, fragment_shader);
gl.linkProgram(shader_program);
var positionAttributeLocation = gl.getAttribLocation(shader_program, "a_position");
gl.useProgram(shader_program);
gl.disable(gl.CULL_FACE);
function draw_mesh(gl, mesh) {
    if (mesh.index_buffer_used) {
        const vao = gl.createVertexArray();
        gl.bindVertexArray(vao);
        gl.enableVertexAttribArray(positionAttributeLocation);
        const vertex_buffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, vertex_buffer);
        gl.bufferData(gl.ARRAY_BUFFER, mesh.vertex_buffer, gl.STATIC_DRAW);
        const position_size = 3;
        const position_offset = 0;
        gl.vertexAttribPointer(positionAttributeLocation, position_size, gl.FLOAT, false, 0, position_offset);
        const index_buffer = gl.createBuffer();
        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, index_buffer);
        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, mesh.index_buffer, gl.STATIC_DRAW);
        gl.bindVertexArray(vao);
        gl.drawElements(gl.TRIANGLES, mesh.index_buffer.length, gl.UNSIGNED_SHORT, 0);
    }
    else {
        const vao = gl.createVertexArray();
        gl.bindVertexArray(vao);
        gl.enableVertexAttribArray(positionAttributeLocation);
        const vertex_buffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, vertex_buffer);
        gl.bufferData(gl.ARRAY_BUFFER, mesh.vertex_buffer, gl.STATIC_DRAW);
        const position_size = 3;
        const position_offset = 0;
        gl.vertexAttribPointer(positionAttributeLocation, position_size, gl.FLOAT, false, 0, position_offset);
        let tri_count = mesh.vertex_buffer.length / 9;
        gl.bindVertexArray(vao);
        gl.drawArrays(gl.TRIANGLES, 0, Math.floor(tri_count));
    }
}
function draw_scene() {
    gl.clearColor(0, 0, 0, 0);
    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
    objects.forEach(object => {
        let current_mesh = meshes.get(object.mesh_id);
        draw_mesh(gl, current_mesh);
    });
}
draw_scene();

/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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bHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gYXNzZXJ0KGNvbmRpdGlvbjogYm9vbGVhbiwgbWVzc2FnZTogc3RyaW5nIHwgbnVsbCA9IG51bGwpIHtcclxuICAgIGlmICghY29uZGl0aW9uKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UgfHwgXCJBc3NlcnRpb24gZmFpbGVkXCIpO1xyXG4gICAgfVxyXG59XHJcblxyXG52YXIgdmVydGV4X3NoYWRlcl9zb3VyY2UgPSBgI3ZlcnNpb24gMzAwIGVzXHJcbmluIHZlYzMgYV9wb3NpdGlvbjtcclxuXHJcbm91dCB2ZWMzIHZDb2xvcjtcclxuXHJcbnZvaWQgbWFpbigpIHtcclxuICAgIGdsX1Bvc2l0aW9uID0gdmVjNChhX3Bvc2l0aW9uLCAxLjApO1xyXG4gICAgdkNvbG9yID0gdmVjMyhhX3Bvc2l0aW9uLnggKyAwLjUsIGFfcG9zaXRpb24ueSArIDAuNSwgYV9wb3NpdGlvbi56ICsgMC41KTsgLy8gQ29sb3IgYmFzZWQgb24gcG9zaXRpb25cclxufWA7XHJcblxyXG52YXIgZnJhZ21lbnRfc2hhZGVyX3NvdXJjZSA9IGAjdmVyc2lvbiAzMDAgZXNcclxucHJlY2lzaW9uIG1lZGl1bXAgZmxvYXQ7XHJcblxyXG5pbiB2ZWMzIHZDb2xvcjtcclxub3V0IHZlYzQgb3V0Q29sb3I7XHJcblxyXG51bmlmb3JtIHNhbXBsZXIyRCB1VGV4dHVyZTtcclxuXHJcbnZvaWQgbWFpbigpIHtcclxuICAgIG91dENvbG9yID0gdmVjNCh2Q29sb3IsIDEuMCk7XHJcbn1gO1xyXG5cclxuY2xhc3MgVmVjdG9yMyB7XHJcbiAgICB4OiBudW1iZXI7XHJcbiAgICB5OiBudW1iZXI7XHJcbiAgICB6OiBudW1iZXI7XHJcblxyXG4gICAgY29uc3RydWN0b3IoeDogbnVtYmVyID0gMCwgeTogbnVtYmVyID0gMCwgejogbnVtYmVyID0gMCkge1xyXG4gICAgICAgIHRoaXMueCA9IHg7XHJcbiAgICAgICAgdGhpcy55ID0geTtcclxuICAgICAgICB0aGlzLnogPSB6O1xyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBUcmFuc2Zvcm0ge1xyXG4gICAgcG9zaXRpb246IFZlY3RvcjM7XHJcbiAgICByb3RhdGlvbjogVmVjdG9yMztcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwb3NpdGlvbjogVmVjdG9yMyA9IG5ldyBWZWN0b3IzKCksIHJvdGF0aW9uOiBWZWN0b3IzID0gbmV3IFZlY3RvcjMoKSkge1xyXG4gICAgICAgIHRoaXMucG9zaXRpb24gPSBwb3NpdGlvbjtcclxuICAgICAgICB0aGlzLnJvdGF0aW9uID0gcm90YXRpb247XHJcbiAgICB9XHJcbn1cclxuXHJcbmNsYXNzIFJlbmRlck9iamVjdCB7XHJcbiAgICB0ZXh0dXJlX2lkOiBudW1iZXI7XHJcbiAgICBtZXNoX2lkOiBudW1iZXI7XHJcbiAgICB0cmFuc2Zvcm06IFRyYW5zZm9ybTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcih0ZXh0dXJlX2lkOiBudW1iZXIgPSBudWxsLCBtZXNoX2lkOiBudW1iZXIgPSBudWxsLCB0cmFuc2Zvcm06IFRyYW5zZm9ybSA9IG5ldyBUcmFuc2Zvcm0oKSkge1xyXG4gICAgICAgIHRoaXMudGV4dHVyZV9pZCA9IHRleHR1cmVfaWQ7XHJcbiAgICAgICAgdGhpcy5tZXNoX2lkID0gbWVzaF9pZDtcclxuICAgICAgICB0aGlzLnRyYW5zZm9ybSA9IHRyYW5zZm9ybTtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgTWVzaCB7XHJcbiAgICB2ZXJ0ZXhfYnVmZmVyOiBGbG9hdDMyQXJyYXk7XHJcbiAgICBpbmRleF9idWZmZXI6IFVpbnQxNkFycmF5IHwgbnVsbDtcclxuICAgIGluZGV4X2J1ZmZlcl91c2VkOiBib29sZWFuO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHZlcnRleF9idWZmZXI6IEZsb2F0MzJBcnJheSwgaW5kZXhfYnVmZmVyOiBVaW50MTZBcnJheSB8IG51bGwgPSBudWxsLCBpbmRleF9idWZmZXJfdXNlZDogYm9vbGVhbiA9IGZhbHNlKSB7XHJcbiAgICAgICAgdGhpcy52ZXJ0ZXhfYnVmZmVyID0gdmVydGV4X2J1ZmZlcjtcclxuICAgICAgICB0aGlzLmluZGV4X2J1ZmZlciA9IGluZGV4X2J1ZmZlcjtcclxuICAgICAgICB0aGlzLmluZGV4X2J1ZmZlcl91c2VkID0gaW5kZXhfYnVmZmVyX3VzZWQ7XHJcbiAgICB9XHJcbn07XHJcblxyXG5jbGFzcyBGbG9hdE1hdHJpeCB7XHJcbiAgICBidWZmZXI6IEZsb2F0NjRBcnJheTtcclxuICAgIG06IG51bWJlcjtcclxuICAgIG46IG51bWJlcjtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihidWZmZXI6IEZsb2F0NjRBcnJheSwgbTogbnVtYmVyLCBuOiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLm0gPSBtO1xyXG4gICAgICAgIHRoaXMubiA9IG47XHJcbiAgICAgICAgdGhpcy5idWZmZXIgPSBidWZmZXI7XHJcbiAgICB9XHJcblxyXG4gICAgcm90YXRlX3ZlY3Rvcihjb2x1bW5fdmVjdG9yOiBWZWN0b3IzKTogVmVjdG9yMyB7XHJcbiAgICAgICAgYXNzZXJ0KHRoaXMubSA9PSAzICYmIHRoaXMubiA9PSAzKTtcclxuICAgICAgICBsZXQgbXVsdGlwbGllZF9jb2x1bW4gPSBuZXcgVmVjdG9yMygpO1xyXG5cclxuICAgICAgICBtdWx0aXBsaWVkX2NvbHVtbi54ICs9IGNvbHVtbl92ZWN0b3IueCAqIHRoaXMuYnVmZmVyWzBdO1xyXG4gICAgICAgIG11bHRpcGxpZWRfY29sdW1uLnggKz0gY29sdW1uX3ZlY3Rvci55ICogdGhpcy5idWZmZXJbMV07XHJcbiAgICAgICAgbXVsdGlwbGllZF9jb2x1bW4ueCArPSBjb2x1bW5fdmVjdG9yLnogKiB0aGlzLmJ1ZmZlclsyXTtcclxuXHJcbiAgICAgICAgbXVsdGlwbGllZF9jb2x1bW4ueSArPSBjb2x1bW5fdmVjdG9yLnggKiB0aGlzLmJ1ZmZlclszXTtcclxuICAgICAgICBtdWx0aXBsaWVkX2NvbHVtbi55ICs9IGNvbHVtbl92ZWN0b3IueSAqIHRoaXMuYnVmZmVyWzRdO1xyXG4gICAgICAgIG11bHRpcGxpZWRfY29sdW1uLnkgKz0gY29sdW1uX3ZlY3Rvci56ICogdGhpcy5idWZmZXJbNV07XHJcblxyXG4gICAgICAgIG11bHRpcGxpZWRfY29sdW1uLnogKz0gY29sdW1uX3ZlY3Rvci54ICogdGhpcy5idWZmZXJbNl07XHJcbiAgICAgICAgbXVsdGlwbGllZF9jb2x1bW4ueiArPSBjb2x1bW5fdmVjdG9yLnkgKiB0aGlzLmJ1ZmZlcls3XTtcclxuICAgICAgICBtdWx0aXBsaWVkX2NvbHVtbi56ICs9IGNvbHVtbl92ZWN0b3IueiAqIHRoaXMuYnVmZmVyWzhdO1xyXG5cclxuICAgICAgICByZXR1cm4gbXVsdGlwbGllZF9jb2x1bW47XHJcbiAgICB9XHJcblxyXG4gICAgbXVsdGlwbHkobWF0cml4X2I6IEZsb2F0TWF0cml4KTogRmxvYXRNYXRyaXgge1xyXG4gICAgICAgIFxyXG4gICAgICAgIGxldCBkb3RfcHJvZHVjdCA9IG5ldyBGbG9hdE1hdHJpeChuZXcgRmxvYXQ2NEFycmF5KHRoaXMubSAqIG1hdHJpeF9iLm4pLCB0aGlzLm0sIG1hdHJpeF9iLm4pO1xyXG4gICAgICAgIGZvciAobGV0IGFfcm93ID0gMDsgYV9yb3cgPCB0aGlzLm07IGFfcm93KyspIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgYl9jb2wgPSAwOyBiX2NvbCA8IG1hdHJpeF9iLm47IGJfY29sKyspIHtcclxuICAgICAgICAgICAgICAgIGxldCBwcm9kdWN0X3N1bSA9IDA7XHJcbiAgICAgICAgICAgICAgICBsZXQgY291bnQgPSAwO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKGNvdW50IDwgdGhpcy5uKXtcclxuICAgICAgICAgICAgICAgICAgICBwcm9kdWN0X3N1bSArPSB0aGlzLmJ1ZmZlclthX3JvdyAqIHRoaXMubiArIGNvdW50XSAqIG1hdHJpeF9iLmJ1ZmZlcltjb3VudCAqIG1hdHJpeF9iLm4gKyBiX2NvbF07XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYHByb2R1Y3Rfc3VtOiAke3Byb2R1Y3Rfc3VtfSwgYV9yb3c6ICR7YV9yb3d9LCBiX2NvbDogJHtiX2NvbH0sIGNvdW50OiAke2NvdW50fWApO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvdW50ICs9IDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBkb3RfcHJvZHVjdC5idWZmZXJbYV9yb3cgKiBkb3RfcHJvZHVjdC5uICsgYl9jb2xdID0gcHJvZHVjdF9zdW07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGRvdF9wcm9kdWN0IDtcclxuICAgIH1cclxufTtcclxuXHJcbnZhciByZW5kZXJfb2JqZWN0czogQXJyYXk8UmVuZGVyT2JqZWN0PiA9IG5ldyBBcnJheSgpO1xyXG52YXIgdGV4dHVyZV9tYXA6IE1hcDxudW1iZXIsIFdlYkdMVGV4dHVyZT4gPSBuZXcgTWFwKCk7XHJcbnZhciBtZXNoX21hcDogTWFwPG51bWJlciwgTWVzaD4gPSBuZXcgTWFwKCk7XHJcblxyXG5mdW5jdGlvbiByZW5kZXIoKSB7XHJcbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUocmVuZGVyKTtcclxuICAgIFxyXG59XHJcblxyXG5mdW5jdGlvbiBzdGFydCgpIHtcclxuICAgIHJlbmRlcigpO1xyXG59XHJcblxyXG5cclxuZnVuY3Rpb24gY3JlYXRlX3lfYXhpc19yb3RhdGlvbl9tYXRyaXgodGhldGE6IG51bWJlcik6IEZsb2F0TWF0cml4IHtcclxuICAgIHJldHVybiBuZXcgRmxvYXRNYXRyaXgobmV3IEZsb2F0NjRBcnJheShbTWF0aC5jb3ModGhldGEpLCAwLCBNYXRoLnNpbih0aGV0YSksIDAsIDEsIDAsIC1NYXRoLnNpbih0aGV0YSksIDAsIE1hdGguY29zKHRoZXRhKV0pLCAzLCAzKTtcclxufVxyXG5cclxuZnVuY3Rpb24gY3JlYXRlX3NwaGVyZV9tZXNoKHJhZGl1c19tZXRlcnM6IG51bWJlciA9IDEsIHNlZ21lbnRzOiBudW1iZXIgPSA2LCByaW5nczogbnVtYmVyID0gMTIpIHtcclxuICAgIGxldCBzcGhlcmVfdmVydGljZXM6IEFycmF5PFZlY3RvcjM+ID0gW25ldyBWZWN0b3IzKDAsIDEsIDApXTtcclxuICAgIFxyXG4gICAgZm9yKGxldCBpID0gMTsgaSA8IHJpbmdzIC0gMTsgaSsrKSB7XHJcbiAgICAgICAgbGV0IHRoZXRhID0gTWF0aC5QSSAvIDIgLSAoTWF0aC5QSSAvIHJpbmdzICogaSk7XHJcbiAgICAgICAgbGV0IHggPSBNYXRoLmNvcyh0aGV0YSkgKiByYWRpdXNfbWV0ZXJzO1xyXG4gICAgICAgIGxldCB5ID0gTWF0aC5zaW4odGhldGEpICogcmFkaXVzX21ldGVycztcclxuXHJcbiAgICAgICAgc3BoZXJlX3ZlcnRpY2VzLnB1c2gobmV3IFZlY3RvcjMoeCwgeSkpO1xyXG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgc2VnbWVudHM7IGorKykge1xyXG4gICAgICAgICAgICBsZXQgbmV3X3RoZXRhID0gTWF0aC5QSSAqIDIgKiBqIC8gc2VnbWVudHM7XHJcbiAgICAgICAgICAgIGxldCByb3RhdGlvbl9tYXRyaXggPSBjcmVhdGVfeV9heGlzX3JvdGF0aW9uX21hdHJpeChuZXdfdGhldGEpO1xyXG5cclxuICAgICAgICAgICAgc3BoZXJlX3ZlcnRpY2VzLnB1c2gocm90YXRpb25fbWF0cml4LnJvdGF0ZV92ZWN0b3Ioc3BoZXJlX3ZlcnRpY2VzW2ldKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGxldCBzcGhlcmVfaW5kaWNlczogQXJyYXk8bnVtYmVyPiA9IFtdO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2VnbWVudHMgLSAxOyBpKyspIHtcclxuICAgICAgICBzcGhlcmVfaW5kaWNlcy5wdXNoKDApO1xyXG4gICAgICAgIHNwaGVyZV9pbmRpY2VzLnB1c2goaSArIDEpO1xyXG4gICAgICAgIHNwaGVyZV9pbmRpY2VzLnB1c2goaSArIDIpO1xyXG4gICAgfVxyXG5cclxuICAgIGZvciAobGV0IHJpbmdfaW5kZXggPSAwOyByaW5nX2luZGV4IDwgcmluZ3MgLSAyOyByaW5nX2luZGV4ICsrKSB7XHJcbiAgICAgICAgZm9yIChsZXQgc2VnbWVudF9pbmRleCA9IDA7IHNlZ21lbnRfaW5kZXggPCBzZWdtZW50cyAtIDE7IHNlZ21lbnRfaW5kZXgrKyApIHtcclxuICAgICAgICAgICAgc3BoZXJlX2luZGljZXMucHVzaChyaW5nX2luZGV4ICogc2VnbWVudHMgKyAxICsgc2VnbWVudF9pbmRleCk7XHJcbiAgICAgICAgICAgIHNwaGVyZV9pbmRpY2VzLnB1c2gocmluZ19pbmRleCAqIHNlZ21lbnRzICsgMiArIHNlZ21lbnRfaW5kZXgpO1xyXG4gICAgICAgICAgICBzcGhlcmVfaW5kaWNlcy5wdXNoKChyaW5nX2luZGV4ICsgMSkgKiBzZWdtZW50cyArIHNlZ21lbnRfaW5kZXggKiAyKVxyXG5cclxuICAgICAgICAgICAgc3BoZXJlX2luZGljZXMucHVzaChyaW5nX2luZGV4ICogc2VnbWVudHMgKyAxICsgc2VnbWVudF9pbmRleCk7XHJcbiAgICAgICAgICAgIHNwaGVyZV9pbmRpY2VzLnB1c2goKHJpbmdfaW5kZXggKyAxKSAqIHNlZ21lbnRzICsgMSArIHNlZ21lbnRfaW5kZXggKiAyKVxyXG4gICAgICAgICAgICBzcGhlcmVfaW5kaWNlcy5wdXNoKChyaW5nX2luZGV4ICsgMSkgKiBzZWdtZW50cyArIDEgKyAoc2VnbWVudF9pbmRleCArIDEpICogMilcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZWdtZW50cyAtIDE7IGkrKykge1xyXG4gICAgICAgIHNwaGVyZV9pbmRpY2VzLnB1c2goc3BoZXJlX3ZlcnRpY2VzLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgIHNwaGVyZV9pbmRpY2VzLnB1c2goc3BoZXJlX3ZlcnRpY2VzLmxlbmd0aCAtIDIgLSBpKTtcclxuICAgICAgICBzcGhlcmVfaW5kaWNlcy5wdXNoKHNwaGVyZV92ZXJ0aWNlcy5sZW5ndGggLSAzIC0gaSk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHZlcnRleF9idWZmZXIgPSBuZXcgQXJyYXk8bnVtYmVyPigpO1xyXG4gICAgZm9yIChsZXQgdmVydGV4X2luZGV4ID0gMDsgdmVydGV4X2luZGV4IDwgc3BoZXJlX3ZlcnRpY2VzLmxlbmd0aDsgdmVydGV4X2luZGV4KyspIHtcclxuICAgICAgICB2ZXJ0ZXhfYnVmZmVyLnB1c2goc3BoZXJlX3ZlcnRpY2VzW3ZlcnRleF9pbmRleF0ueClcclxuICAgICAgICB2ZXJ0ZXhfYnVmZmVyLnB1c2goc3BoZXJlX3ZlcnRpY2VzW3ZlcnRleF9pbmRleF0ueSlcclxuICAgICAgICB2ZXJ0ZXhfYnVmZmVyLnB1c2goc3BoZXJlX3ZlcnRpY2VzW3ZlcnRleF9pbmRleF0ueilcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gbmV3IE1lc2gobmV3IEZsb2F0MzJBcnJheSh2ZXJ0ZXhfYnVmZmVyKSwgbmV3IFVpbnQxNkFycmF5KHNwaGVyZV9pbmRpY2VzKSwgdHJ1ZSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZV9yZWN0X21lc2goeDogbnVtYmVyLCB5OiBudW1iZXIsIHo6IG51bWJlciwgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpOiBNZXNoIHtcclxuICAgIHJldHVybiBuZXcgTWVzaChcclxuICAgICAgICBuZXcgRmxvYXQzMkFycmF5KFtcclxuICAgICAgICAgICAgLy8gRmlyc3QgdHJpXHJcbiAgICAgICAgICAgIHgsIHksIHosXHJcbiAgICAgICAgICAgIHggKyB3aWR0aCwgeSwgeixcclxuICAgICAgICAgICAgeCwgeSArIGhlaWdodCwgeiwgXHJcbiAgICAgICAgICAgIC8vIFNlY29uZCB0cmlcclxuICAgICAgICAgICAgeCArIHdpZHRoLCB5LCB6LFxyXG4gICAgICAgICAgICB4LCB5ICsgaGVpZ2h0LCB6LCBcclxuICAgICAgICAgICAgeCArIHdpZHRoLCB5ICsgaGVpZ2h0LCB6LCBcclxuICAgICAgICBdKVxyXG4gICAgKVxyXG59XHJcblxyXG5sZXQgbWVzaGVzID0gbmV3IE1hcDxudW1iZXIsIE1lc2g+KCk7XHJcbmNvbnN0IFNQSEVSRV9NRVNIID0gMDtcclxubWVzaGVzLnNldChTUEhFUkVfTUVTSCwgY3JlYXRlX3NwaGVyZV9tZXNoKDEsIDUsIDUpKVxyXG5jb25zdCBSRUNUX01FU0ggPSAxO1xyXG5tZXNoZXMuc2V0KFJFQ1RfTUVTSCwgY3JlYXRlX3JlY3RfbWVzaCgwLCAwLCAwLCA1LCA1KSk7XHJcblxyXG5sZXQgY3VycmVudF9tZXNoID0gbWVzaGVzLmdldChTUEhFUkVfTUVTSCk7XHJcblxyXG5sZXQgY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiY2FudmFzXCIpLml0ZW0oMCk7XHJcbmxldCBnbCA9IGNhbnZhcy5nZXRDb250ZXh0KFwid2ViZ2wyXCIpOyBcclxubGV0IG9iamVjdHM6IEFycmF5PFJlbmRlck9iamVjdD4gPSBbbmV3IFJlbmRlck9iamVjdChudWxsLCBSRUNUX01FU0gsIG5ldyBUcmFuc2Zvcm0obmV3IFZlY3RvcjMoMCwgMCwgMCksIG5ldyBWZWN0b3IzKDAsIDAsIDApKSldO1xyXG5cclxuY29uc3QgdmVydGV4X3NoYWRlciA9IGdsLmNyZWF0ZVNoYWRlcihnbC5WRVJURVhfU0hBREVSKTtcclxuZ2wuc2hhZGVyU291cmNlKHZlcnRleF9zaGFkZXIsIHZlcnRleF9zaGFkZXJfc291cmNlKTtcclxuZ2wuY29tcGlsZVNoYWRlcih2ZXJ0ZXhfc2hhZGVyKTtcclxuXHJcbmNvbnN0IGZyYWdtZW50X3NoYWRlciA9IGdsLmNyZWF0ZVNoYWRlcihnbC5GUkFHTUVOVF9TSEFERVIpO1xyXG5nbC5zaGFkZXJTb3VyY2UoZnJhZ21lbnRfc2hhZGVyLCBmcmFnbWVudF9zaGFkZXJfc291cmNlKTtcclxuZ2wuY29tcGlsZVNoYWRlcihmcmFnbWVudF9zaGFkZXIpO1xyXG5cclxuY29uc3Qgc2hhZGVyX3Byb2dyYW0gPSBnbC5jcmVhdGVQcm9ncmFtKCk7XHJcbmdsLmF0dGFjaFNoYWRlcihzaGFkZXJfcHJvZ3JhbSwgdmVydGV4X3NoYWRlcik7XHJcbmdsLmF0dGFjaFNoYWRlcihzaGFkZXJfcHJvZ3JhbSwgZnJhZ21lbnRfc2hhZGVyKTtcclxuZ2wubGlua1Byb2dyYW0oc2hhZGVyX3Byb2dyYW0pO1xyXG5cclxudmFyIHBvc2l0aW9uQXR0cmlidXRlTG9jYXRpb24gPSBnbC5nZXRBdHRyaWJMb2NhdGlvbihzaGFkZXJfcHJvZ3JhbSwgXCJhX3Bvc2l0aW9uXCIpO1xyXG5cclxuZ2wudXNlUHJvZ3JhbShzaGFkZXJfcHJvZ3JhbSk7XHJcbmdsLmRpc2FibGUoZ2wuQ1VMTF9GQUNFKTtcclxuXHJcblxyXG5mdW5jdGlvbiBkcmF3X21lc2goZ2w6IFdlYkdMMlJlbmRlcmluZ0NvbnRleHQsIG1lc2g6IE1lc2gpIHtcclxuICAgIGlmIChtZXNoLmluZGV4X2J1ZmZlcl91c2VkKSB7XHJcblxyXG4gICAgICAgIGNvbnN0IHZhbyA9IGdsLmNyZWF0ZVZlcnRleEFycmF5KCk7XHJcbiAgICAgICAgZ2wuYmluZFZlcnRleEFycmF5KHZhbyk7XHJcblxyXG4gICAgICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KHBvc2l0aW9uQXR0cmlidXRlTG9jYXRpb24pO1xyXG5cclxuICAgICAgICBjb25zdCB2ZXJ0ZXhfYnVmZmVyID0gZ2wuY3JlYXRlQnVmZmVyKCk7XHJcbiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHZlcnRleF9idWZmZXIpO1xyXG4gICAgICAgIGdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCBtZXNoLnZlcnRleF9idWZmZXIsIGdsLlNUQVRJQ19EUkFXKTtcclxuXHJcbiAgICAgICAgY29uc3QgcG9zaXRpb25fc2l6ZSA9IDM7XHJcbiAgICAgICAgY29uc3QgcG9zaXRpb25fb2Zmc2V0ID0gMDtcclxuICAgICAgICBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKHBvc2l0aW9uQXR0cmlidXRlTG9jYXRpb24sIHBvc2l0aW9uX3NpemUsIGdsLkZMT0FULCBmYWxzZSwgMCwgcG9zaXRpb25fb2Zmc2V0KTtcclxuXHJcbiAgICAgICAgY29uc3QgaW5kZXhfYnVmZmVyID0gZ2wuY3JlYXRlQnVmZmVyKCk7XHJcbiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgaW5kZXhfYnVmZmVyKTtcclxuICAgICAgICBnbC5idWZmZXJEYXRhKGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSLCBtZXNoLmluZGV4X2J1ZmZlciwgZ2wuU1RBVElDX0RSQVcpO1xyXG5cclxuICAgICAgICBnbC5iaW5kVmVydGV4QXJyYXkodmFvKTtcclxuICAgICAgICBnbC5kcmF3RWxlbWVudHMoZ2wuVFJJQU5HTEVTLCBtZXNoLmluZGV4X2J1ZmZlci5sZW5ndGgsIGdsLlVOU0lHTkVEX1NIT1JULCAwKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IHZhbyA9IGdsLmNyZWF0ZVZlcnRleEFycmF5KCk7XHJcbiAgICAgICAgZ2wuYmluZFZlcnRleEFycmF5KHZhbyk7XHJcblxyXG4gICAgICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KHBvc2l0aW9uQXR0cmlidXRlTG9jYXRpb24pO1xyXG5cclxuICAgICAgICBjb25zdCB2ZXJ0ZXhfYnVmZmVyID0gZ2wuY3JlYXRlQnVmZmVyKCk7XHJcblxyXG4gICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCB2ZXJ0ZXhfYnVmZmVyKTtcclxuICAgICAgICBnbC5idWZmZXJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgbWVzaC52ZXJ0ZXhfYnVmZmVyLCBnbC5TVEFUSUNfRFJBVyk7XHJcblxyXG4gICAgICAgIGNvbnN0IHBvc2l0aW9uX3NpemUgPSAzO1xyXG4gICAgICAgIGNvbnN0IHBvc2l0aW9uX29mZnNldCA9IDA7XHJcbiAgICAgICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcihwb3NpdGlvbkF0dHJpYnV0ZUxvY2F0aW9uLCBwb3NpdGlvbl9zaXplLCBnbC5GTE9BVCwgZmFsc2UsIDAsIHBvc2l0aW9uX29mZnNldCk7XHJcblxyXG4gICAgICAgIGxldCB0cmlfY291bnQgPSBtZXNoLnZlcnRleF9idWZmZXIubGVuZ3RoIC8gOTtcclxuICAgICAgICBnbC5iaW5kVmVydGV4QXJyYXkodmFvKTtcclxuICAgICAgICBnbC5kcmF3QXJyYXlzKGdsLlRSSUFOR0xFUywgMCwgTWF0aC5mbG9vcih0cmlfY291bnQpKTtcclxuXHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGRyYXdfc2NlbmUoKSB7XHJcbiAgICBnbC5jbGVhckNvbG9yKDAsIDAsIDAsIDApO1xyXG4gICAgZ2wuY2xlYXIoZ2wuQ09MT1JfQlVGRkVSX0JJVCB8IGdsLkRFUFRIX0JVRkZFUl9CSVQpO1xyXG5cclxuXHJcbiAgICBvYmplY3RzLmZvckVhY2gob2JqZWN0ID0+IHtcclxuICAgICAgICBsZXQgY3VycmVudF9tZXNoID0gbWVzaGVzLmdldChvYmplY3QubWVzaF9pZCk7XHJcblxyXG4gICAgICAgIGRyYXdfbWVzaChnbCwgY3VycmVudF9tZXNoKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5kcmF3X3NjZW5lKCk7XHJcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==